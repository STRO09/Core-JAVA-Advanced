package operations;

import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.swing.JOptionPane;

import connect.GetConnection;

public class OpsImp implements Ops {

	@Override
	public void insertData(int empid, String empname, String contact) {
		// TODO Auto-generated method stub
		try {

			PreparedStatement selectstatement = GetConnection.getConnection()
					.prepareStatement("SELECT * FROM empdemojdbc where LOWER(username)=? OR contact=? OR empid=?");
			selectstatement.setString(1, empname);
			selectstatement.setString(2, contact);
			selectstatement.setInt(3, empid);
			ResultSet resultSet = selectstatement.executeQuery();

			boolean usernameExists = false;
			boolean contactExists = false;
			boolean empidExists = false;

			while (resultSet.next()) {
				if (resultSet.getString("username").equalsIgnoreCase(empname)) {
					usernameExists = true;
				}
				if (resultSet.getString("contact").equals(contact)) {
					contactExists = true;
				}
				if (resultSet.getInt("empid").equals(empid)) {
					empidExists = true;
				}
			}

			if(usernameExists && contactExists && empidExists) {
				JOptionPane.showMessageDialog(null, "All the fields already exist!");
				return;

			}
			else if (usernameExists && contactExists) {
				JOptionPane.showMessageDialog(null, "Username and contact already exist!");
				return;
			} 
			else if(usernameExists && empidExists) {
				JOptionPane.showMessageDialog(null, "Username and ID already exist!");
				return;
			} 
			
			else if(contactExists && empidExists) {
				JOptionPane.showMessageDialog(null, "Contact number and ID already exist!");
				return;
			} 
			else if (usernameExists) {
				JOptionPane.showMessageDialog(null, "Username already exists!");
				return;
			} else if (contactExists) {
				JOptionPane.showMessageDialog(null, "Contact already exists!");
				return;
			} else if (empidExists) {
				JOptionPane.showMessageDialog(null, "ID already exists!");
				return;
			}

			PreparedStatement preparedStatement = GetConnection.getConnection()
					.prepareStatement("INSERT INTO empdemojdbc values(?,?,?)");
			preparedStatement.setInt(1, empid);
			preparedStatement.setString(2, empname);
			preparedStatement.setString(3, contact);
			preparedStatement.executeUpdate();
			System.out.println("Data inserted successfully");
		} catch (ClassNotFoundException | SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

	@Override
	public void deleteData(int empid) {
		// TODO Auto-generated method stub
		try {
			PreparedStatement preparedStatement = GetConnection.getConnection()
					.prepareStatement("DELETE from empdemojdbc where empid=?");
			preparedStatement.setInt(1, empid);
			preparedStatement.execute();
			System.out.println("Data Deleted Successfully.");
		} catch (ClassNotFoundException | SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

	@Override
	public void updateData(int empid, String contact) {
		// TODO Auto-generated method stub
		PreparedStatement preparedStatement;
		try {
			preparedStatement = GetConnection.getConnection()
					.prepareStatement("UPDATE empdemojdbc SET contact = ? where empid = ?");

			preparedStatement.setString(1, contact);
			preparedStatement.setInt(2, empid);
			preparedStatement.executeUpdate();
			System.out.println("Data Updated Successfully.");
		} catch (ClassNotFoundException | SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	@Override
	public void showData() {
		// TODO Auto-generated method stub
		try {
			Statement statement = GetConnection.getConnection().createStatement();
			ResultSet resultSet = statement.executeQuery("SELECT * from empdemojdbc");

			System.out.println("Employee Data: ");
			int i = 1;
			while (resultSet.next()) {
				System.out.println(i + ". Emp ID: " + resultSet.getInt("empid") + " - Emp Name: "
						+ resultSet.getString("empname") + " - Contact: " + resultSet.getString("contact"));
				i++;
			}
		} catch (ClassNotFoundException | SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

	}

}
